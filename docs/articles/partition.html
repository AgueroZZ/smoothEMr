<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to coordinate partitioning with smoothEMr • smoothEMr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to coordinate partitioning with smoothEMr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smoothEMr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro.html">Intro to smoothEMr</a>
    </li>
    <li>
      <a href="../articles/partition.html">Introduction to coordinate partitioning with smoothEMr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to coordinate partitioning with
smoothEMr</h1>
            
      

      <div class="hidden name"><code>partition.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">smoothEMr</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-feature-partition-problem">The feature-partition problem<a class="anchor" aria-label="anchor" href="#the-feature-partition-problem"></a>
</h2>
<div class="section level3">
<h3 id="problem-statement">Problem statement<a class="anchor" aria-label="anchor" href="#problem-statement"></a>
</h3>
<p>We observe a data matrix
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mi>n</mi><mo>×</mo><mi>d</mi></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">
X \in \mathbb{R}^{n \times d},
</annotation></semantics></math> where each column (feature) may follow
<strong>one of two different latent orderings of the samples</strong>.
Let the feature index set be
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mi>d</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>:=</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>d</mi><mo stretchy="false" form="postfix">}</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
[d] := \{1,2,\dots,d\}.
</annotation></semantics></math></p>
<p>We seek a partition of features into two disjoint sets
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mn>1</mn></msub><mo>∪</mo><msub><mi>J</mi><mn>2</mn></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>d</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="2.0em"></mspace><msub><mi>J</mi><mn>1</mn></msub><mo>∩</mo><msub><mi>J</mi><mn>2</mn></msub><mo>=</mo><mi>∅</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
J_1 \cup J_2 = [d], \qquad J_1 \cap J_2 = \emptyset,
</annotation></semantics></math> such that features in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>J</mi><mn>1</mn></msub><annotation encoding="application/x-tex">J_1</annotation></semantics></math>
are best explained by ordering system 1, and features in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>J</mi><mn>2</mn></msub><annotation encoding="application/x-tex">J_2</annotation></semantics></math>
are best explained by ordering system 2.</p>
</div>
<div class="section level3">
<h3 id="latent-ordering-via-responsibilities">Latent ordering via responsibilities<a class="anchor" aria-label="anchor" href="#latent-ordering-via-responsibilities"></a>
</h3>
<p>In <code>csmoothEM</code>, each ordering system is represented by an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">n \times K</annotation></semantics></math>
responsibility matrix
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>γ</mi><mrow><mi>i</mi><mi>k</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mi>.</mi><mi>.</mi><mi>n</mi><mo>,</mo><mspace width="0.167em"></mspace><mi>k</mi><mo>=</mo><mn>1</mn><mi>.</mi><mi>.</mi><mi>K</mi></mrow></msub><mo>,</mo><mspace width="2.0em"></mspace><mi>m</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo stretchy="false" form="postfix">}</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">
\Gamma^{(m)} = \left(\gamma^{(m)}_{ik}\right)_{i=1..n,\,k=1..K}, \qquad m \in \{1,2\},
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>γ</mi><mrow><mi>i</mi><mi>k</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\gamma^{(m)}_{ik}</annotation></semantics></math>
is the (soft) membership probability of sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in component/bin
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
under ordering
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
You can view
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(m)}</annotation></semantics></math>
as a soft discretization of a latent 1D ordering into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
bins.</p>
<p>Each ordering system
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
also has csmoothEM parameters
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>σ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\theta^{(m)} = (\pi^{(m)}, \mu^{(m)}, \sigma^{(m)}, \lambda^{(m)}),
</annotation></semantics></math> where (in the homoskedastic csmoothEM
setting used here):</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∈</mo><msup><mi>ℝ</mi><mi>K</mi></msup></mrow><annotation encoding="application/x-tex">\pi^{(m)} \in \mathbb{R}^K</annotation></semantics></math>
are mixture weights,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>μ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∈</mo><msup><mi>ℝ</mi><mrow><msub><mi>d</mi><mi>m</mi></msub><mo>×</mo><mi>K</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mu^{(m)} \in \mathbb{R}^{d_m \times K}</annotation></semantics></math>
are component means for features in the corresponding subset,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∈</mo><msup><mi>ℝ</mi><msub><mi>d</mi><mi>m</mi></msub></msup></mrow><annotation encoding="application/x-tex">\sigma^{(m)} \in \mathbb{R}^{d_m}</annotation></semantics></math>
are per-feature standard deviations,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∈</mo><msup><mi>ℝ</mi><msub><mi>d</mi><mi>m</mi></msub></msup></mrow><annotation encoding="application/x-tex">\lambda^{(m)} \in \mathbb{R}^{d_m}</annotation></semantics></math>
are per-feature smoothness strengths for a RW prior along
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>.</li>
</ul>
<p>(Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>m</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>J</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">d_m = |J_m|</annotation></semantics></math>.)</p>
</div>
<div class="section level3">
<h3 id="scoring-a-feature-against-a-fixed-ordering">Scoring a feature against a fixed ordering<a class="anchor" aria-label="anchor" href="#scoring-a-feature-against-a-fixed-ordering"></a>
</h3>
<p>A key ingredient in both greedy partition procedures is a
feature-wise alignment score: for a candidate feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
given a fixed responsibilities matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>,
we compute a scalar score
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>∣</mo><mi>Γ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
S(j \mid \Gamma)
</annotation></semantics></math> that measures how well feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
aligns with the ordering encoded by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>.</p>
<p>The package provides two score modes through
<code>score_mode</code>:</p>
<ul>
<li>
<code>score_mode = "none"</code>: a plug-in (ELBO) score with fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda=1</annotation></semantics></math>.</li>
<li>
<code>score_mode = "ml"</code>: a collapsed (marginal-like) score
with per-feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\lambda_j</annotation></semantics></math>
optimized.</li>
</ul>
<p>Both modes rely on the same idea: <strong>given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math></strong>,
we can fit feature-specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mi>j</mi><mo>⋅</mo></mrow></msub><annotation encoding="application/x-tex">\mu_{j\cdot}</annotation></semantics></math>
(and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>j</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_j^2</annotation></semantics></math>)
in closed form (or near closed form), then evaluate a comparable scalar
objective.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="simulated-example">Simulated example<a class="anchor" aria-label="anchor" href="#simulated-example"></a>
</h2>
<p>We simulate a dataset where half of the features follow one latent
ordering and the other half follow a second ordering. We also permute
the feature columns to make the labels nontrivial.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_two_order_gp_dataset.html">simulate_two_order_gp_dataset</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  D <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  t_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  range <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  smoothness <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  variance <span class="op">=</span> <span class="fl">3.0</span>,</span>
<span>  noise_sd <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">true_group</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">true_group</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Simulated X:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulated X: 1000 x 16</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">true_group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; true_group</span></span>
<span><span class="co">#&gt; 1 2 </span></span>
<span><span class="co">#&gt; 8 8</span></span></code></pre></div>
<div class="section level3">
<h3 id="quick-visualization">Quick visualization<a class="anchor" aria-label="anchor" href="#quick-visualization"></a>
</h3>
<p>Instead of a heatmap, we first plot a few representative features
from each ordering. Because <code>permute_rows_block2=TRUE</code>
permutes the sample order for the second block, features from ordering 2
typically look misaligned when plotted against the raw sample index.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pick one representative feature from each true group</span></span>
<span><span class="va">idx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">true_group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">idx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">true_group</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">j1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">idx1</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># a feature generated by ordering 1</span></span>
<span><span class="va">j2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">idx2</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># a feature generated by ordering 2</span></span>
<span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">j1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co"># z-score for comparability</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">j2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct the two "true" orderings for rows</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">t1</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">t2</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">row_perm_block2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">t2</span> <span class="op">&lt;-</span> <span class="va">t2</span><span class="op">[</span><span class="va">sim</span><span class="op">$</span><span class="va">row_perm_block2</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ordering indices</span></span>
<span><span class="va">o1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="va">o2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (1) feature from ordering 1 vs ordering 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t1</span><span class="op">[</span><span class="va">o1</span><span class="op">]</span>, <span class="va">x1</span><span class="op">[</span><span class="va">o1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"t1 (ordering 1)"</span>, ylab <span class="op">=</span> <span class="st">"z-scored feature value"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ord1 feature (%s)\nagainst ordering 1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">j1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (2) feature from ordering 2 vs ordering 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t1</span><span class="op">[</span><span class="va">o1</span><span class="op">]</span>, <span class="va">x2</span><span class="op">[</span><span class="va">o1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"t1 (ordering 1)"</span>, ylab <span class="op">=</span> <span class="st">"z-scored feature value"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ord2 feature (%s)\nagainst ordering 1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">j2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (3) feature from ordering 1 vs ordering 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t2</span><span class="op">[</span><span class="va">o2</span><span class="op">]</span>, <span class="va">x1</span><span class="op">[</span><span class="va">o2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"t2 (ordering 2)"</span>, ylab <span class="op">=</span> <span class="st">"z-scored feature value"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ord1 feature (%s)\nagainst ordering 2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">j1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (4) feature from ordering 2 vs ordering 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t2</span><span class="op">[</span><span class="va">o2</span><span class="op">]</span>, <span class="va">x2</span><span class="op">[</span><span class="va">o2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"t2 (ordering 2)"</span>, ylab <span class="op">=</span> <span class="st">"z-scored feature value"</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ord2 feature (%s)\nagainst ordering 2"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">j2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="partition_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="approach-1-forward-greedy-partition">Approach 1: Forward greedy partition<a class="anchor" aria-label="anchor" href="#approach-1-forward-greedy-partition"></a>
</h2>
<div class="section level3">
<h3 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h3>
<p>The forward greedy algorithm proceeds as follows:</p>
<ol style="list-style-type: decimal">
<li>Choose a seed feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>j</mi><mn>1</mn></msub><annotation encoding="application/x-tex">j_1</annotation></semantics></math>
and fit a 1D csmoothEM ordering to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(1)}</annotation></semantics></math>.</li>
<li>Choose a second seed feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>j</mi><mn>2</mn></msub><annotation encoding="application/x-tex">j_2</annotation></semantics></math>
as the feature with the worst alignment score under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(1)}</annotation></semantics></math>,
and fit a 1D csmoothEM ordering to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(2)}</annotation></semantics></math>.</li>
<li>While unassigned features remain:
<ul>
<li>score each remaining feature under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(1)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(2)}</annotation></semantics></math>,</li>
<li>pick the feature with the largest absolute score gap,</li>
<li>assign it to the ordering with higher score,</li>
<li>warm-start update the corresponding ordering (update
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\theta^{(m)}</annotation></semantics></math>
and then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(m)}</annotation></semantics></math>).</li>
</ul>
</li>
</ol>
<p>In the implementation, the ordering-specific objects are returned as
two <code>csmooth_em</code> fits (<code>fit1</code>,
<code>fit2</code>).</p>
</div>
<div class="section level3">
<h3 id="run">Run<a class="anchor" aria-label="anchor" href="#run"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">res_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forward_two_ordering_partition_csmooth.html">forward_two_ordering_partition_csmooth</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  score_mode <span class="op">=</span> <span class="st">"ml"</span>,</span>
<span>  greedy_em_refine <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  greedy_em_max_iter <span class="op">=</span> <span class="fl">10</span>,  </span>
<span>  verbose <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] seeds: j1=4, j2=9</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 3 -&gt; ord1 (|Δ|=2357.548), remaining=13</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 5 -&gt; ord1 (|Δ|=1979.785), remaining=12</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 13 -&gt; ord2 (|Δ|=1898.020), remaining=11</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 1 -&gt; ord1 (|Δ|=1815.358), remaining=10</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 6 -&gt; ord1 (|Δ|=1547.641), remaining=9</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 2 -&gt; ord1 (|Δ|=1511.510), remaining=8</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 7 -&gt; ord1 (|Δ|=1344.981), remaining=7</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 10 -&gt; ord2 (|Δ|=1295.184), remaining=6</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 16 -&gt; ord2 (|Δ|=1062.702), remaining=5</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 8 -&gt; ord1 (|Δ|=788.595), remaining=4</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 14 -&gt; ord2 (|Δ|=513.117), remaining=3</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 11 -&gt; ord2 (|Δ|=1374.790), remaining=2</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 12 -&gt; ord2 (|Δ|=1106.892), remaining=1</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] pick 15 -&gt; ord2 (|Δ|=825.989), remaining=0</span></span>
<span><span class="co">#&gt; [Greedy-csmooth] done: |J1|=8, |J2|=8</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="confusion-table-with-label-switching-handled">Confusion table (with label switching handled)<a class="anchor" aria-label="anchor" href="#confusion-table-with-label-switching-handled"></a>
</h3>
<p>The partition labels 1/2 may swap. We compute both possible mappings
and report the better one.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assign_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">res_fwd</span><span class="op">$</span><span class="va">coord_assign</span><span class="op">)</span></span>
<span><span class="va">tab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>true <span class="op">=</span> <span class="va">true_group</span>, est <span class="op">=</span> <span class="va">assign_raw</span><span class="op">)</span></span>
<span><span class="va">tab2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>true <span class="op">=</span> <span class="va">true_group</span>, est <span class="op">=</span> <span class="fl">3L</span> <span class="op">-</span> <span class="va">assign_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">acc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span></span>
<span><span class="va">acc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">acc2</span> <span class="op">&gt;</span> <span class="va">acc1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Forward: using swapped labels\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Accuracy:"</span>, <span class="va">acc2</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Forward: using original labels\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Accuracy:"</span>, <span class="va">acc1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Forward: using original labels</span></span>
<span><span class="co">#&gt;     est</span></span>
<span><span class="co">#&gt; true 1 2</span></span>
<span><span class="co">#&gt;    1 8 0</span></span>
<span><span class="co">#&gt;    2 0 8</span></span>
<span><span class="co">#&gt; Accuracy: 1</span></span></code></pre></div>
<p>You can also inspect the two ordering-specific fitted objects:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res_fwd</span><span class="op">$</span><span class="va">fit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitted csmoothEM object with RW(2) prior along K = 50</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   n = 1000, d = 8, modelName = homoskedastic</span></span>
<span><span class="co">#&gt;   iter = 0; init_method = forward_greedy; adaptive = ml;</span></span>
<span><span class="co">#&gt;   lambda_vec: range=[1, 1], mean=1, relative = TRUE</span></span>
<span><span class="co">#&gt;   ELBO last = NA; penLogLik last = NA; ML/C last = NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res_fwd</span><span class="op">$</span><span class="va">fit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitted csmoothEM object with RW(2) prior along K = 50</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   n = 1000, d = 8, modelName = homoskedastic</span></span>
<span><span class="co">#&gt;   iter = 0; init_method = forward_greedy; adaptive = ml;</span></span>
<span><span class="co">#&gt;   lambda_vec: range=[1, 1], mean=1, relative = TRUE</span></span>
<span><span class="co">#&gt;   ELBO last = NA; penLogLik last = NA; ML/C last = NA</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="approach-2-backward-greedy-partition">Approach 2: Backward greedy partition<a class="anchor" aria-label="anchor" href="#approach-2-backward-greedy-partition"></a>
</h2>
<div class="section level3">
<h3 id="description-1">Description<a class="anchor" aria-label="anchor" href="#description-1"></a>
</h3>
<p>The backward greedy algorithm starts from a single ordering fit and
then moves features to a second ordering if doing so improves the
alignment score.</p>
<ol style="list-style-type: decimal">
<li>Fit ordering 1 on all features to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(1)}</annotation></semantics></math>.</li>
<li>Initialize ordering 2 from a seed feature
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>j</mi><mn>2</mn></msub><annotation encoding="application/x-tex">j_2</annotation></semantics></math>
(by default, the worst-aligned feature under ordering 1), yielding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\Gamma^{(2)}</annotation></semantics></math>.</li>
<li>Repeat:
<ul>
<li>for each feature currently in ordering 1, compute the gain
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>j</mi></msub><mo>=</mo><msub><mi>S</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>∣</mo><msub><mi>Γ</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>S</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>∣</mo><msub><mi>Γ</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Delta_j = S_2(j \mid \Gamma_2) - S_1(j \mid \Gamma_1).
</annotation></semantics></math>
</li>
<li>move the best feature if the gain is positive,</li>
<li>warm-start update both orderings (update
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\theta^{(1)}, \theta^{(2)}</annotation></semantics></math>
and then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\Gamma^{(1)}, \Gamma^{(2)}</annotation></semantics></math>).</li>
</ul>
</li>
</ol>
<p>Importantly, the implementation maintains warm-start state and does
not re-run global ordering initializers after the initial
construction.</p>
</div>
<div class="section level3">
<h3 id="run-1">Run<a class="anchor" aria-label="anchor" href="#run-1"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">res_bwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backward_two_ordering_partition_csmooth.html">backward_two_ordering_partition_csmooth</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  score_mode <span class="op">=</span> <span class="st">"ml"</span>,</span>
<span>  warm_iter_init <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  warm_iter_refit <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [backward-init] seedB=9 (ord2_1), |A|=15 |B|=1</span></span>
<span><span class="co">#&gt; [backward 01] move 13 (ord2_5) gain=980.061 |A|=14 |B|=2</span></span>
<span><span class="co">#&gt; [backward 02] move 10 (ord2_2) gain=544.599 |A|=13 |B|=3</span></span>
<span><span class="co">#&gt; [backward 03] move 16 (ord2_8) gain=353.388 |A|=12 |B|=4</span></span>
<span><span class="co">#&gt; [backward 04] no positive gain; stopping.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="confusion-table-with-label-switching-handled-1">Confusion table (with label switching handled)<a class="anchor" aria-label="anchor" href="#confusion-table-with-label-switching-handled-1"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assign_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">res_bwd</span><span class="op">$</span><span class="va">assign</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="va">tab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>true <span class="op">=</span> <span class="va">true_group</span>, est <span class="op">=</span> <span class="va">assign_raw</span><span class="op">)</span></span>
<span><span class="va">tab2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>true <span class="op">=</span> <span class="va">true_group</span>, est <span class="op">=</span> <span class="fl">3L</span> <span class="op">-</span> <span class="va">assign_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">acc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span></span>
<span><span class="va">acc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">acc2</span> <span class="op">&gt;</span> <span class="va">acc1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Backward: using swapped labels\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tab2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Accuracy:"</span>, <span class="va">acc2</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Backward: using original labels\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Accuracy:"</span>, <span class="va">acc1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Backward: using original labels</span></span>
<span><span class="co">#&gt;     est</span></span>
<span><span class="co">#&gt; true 1 2</span></span>
<span><span class="co">#&gt;    1 8 0</span></span>
<span><span class="co">#&gt;    2 4 4</span></span>
<span><span class="co">#&gt; Accuracy: 0.75</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ziang Zhang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
