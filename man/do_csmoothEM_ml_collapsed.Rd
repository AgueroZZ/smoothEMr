% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/06_cSmoothEM.R
\name{do_csmoothEM_ml_collapsed}
\alias{do_csmoothEM_ml_collapsed}
\title{Run collapsed-ML csmoothEM iterations (homoskedastic only)}
\usage{
do_csmoothEM_ml_collapsed(
  object,
  data = NULL,
  iter = 1,
  record = TRUE,
  lambda_min = NULL,
  lambda_max = NULL,
  sigma_update = c("mstep", "ml"),
  sigma_min = 1e-10,
  sigma_max = 1e+10,
  verbose = FALSE
)
}
\arguments{
\item{object}{A \code{csmooth_em} object.}

\item{data}{Optional n-by-d data matrix. If NULL, uses \code{object$data}.}

\item{iter}{Integer >= 1 number of iterations.}

\item{record}{Logical; if TRUE, record traces.}

\item{lambda_min, lambda_max}{Bounds for lambda optimization.}

\item{sigma_update}{Either \code{"mstep"} (standard M-step update) or \code{"ml"} (optimize collapsed objective).}

\item{sigma_min, sigma_max}{Bounds for sigma2 when \code{sigma_update="ml"}.}

\item{verbose}{Logical.}
}
\value{
Updated \code{csmooth_em} object.
}
\description{
Iteration order (collapsed-ML):
1) E-step: update responsibilities using current (MAP) \eqn{\mu}.
2) Hyper-step: update \eqn{\pi}, \eqn{\lambda}, and optionally \eqn{\sigma^2}.
3) M-step: update MAP \eqn{\mu} given current responsibilities and hyperparameters.
4) Record: penalized observed objective (\code{loglik_trace}), penalized ELBO
   (\code{elbo_trace}), collapsed objective \eqn{\mathcal{C}} (\code{ml_trace}),
   and \code{logdetH_trace}.
}
\details{
The recorded \code{ml_trace} is the collapsed objective
\deqn{\mathcal{C} \;=\; \text{penELBO} \;+\; \frac{dK}{2}\log(2\pi) \;-\; \frac12 \log|H|,}
where \eqn{H} is the Hessian/precision w.r.t. \eqn{\mu} (block-diagonal over coordinates).
}
